<launch>

  <arg name="bagfile_home" value="$(env GALT_BAGFILES)/day1/noon"/>
  <arg name="bagfile" default="2014-07-24-15-48-44"/>
  <arg name="bagfile_start" default="95"/>
  <arg name="csv_dump" default="false"/>
  <arg name="csv_replay" default="true"/>

  <!-- start bagfile playback -->
  <node pkg="rosbag" type="play" name="player"
        args="-s $(arg bagfile_start) -r 1 $(arg bagfile_home)/$(arg bagfile).bag">
  </node>

  <!-- laser scan filter -->
  <include file="$(find galt_setup)/launch/scan_filter.launch"/>

  <!-- start sam estimator -->
  <include file="$(find sam_estimator)/launch/sam_estimator.launch"/>

  <!-- launch disparity -->
  <node if="false"
      pkg="image_view" type="stereo_view" name="stereo_view"
      args="stereo:=/mv_stereo image:=image_rect">
  </node>

  <!-- launch CSV output node -->
  <node if="$(arg csv_dump)"
    pkg="path_capture" type="path_capture" name="path_capture">
    <param name="output_path" type="string" value="$(env HOME)/.ros/$(arg bagfile)"/>
    <remap from="~gps_odom" to="/gps_odom/odometry"/>
    <remap from="~sam_odom" to="/sam_estimator/odometry"/>
    <remap from="~height" to="/laser_altimeter/height"/>
  </node>

  <!-- launch CSV input node
    * creates /path_replay/odometry
   -->
  <node if="$(arg csv_replay)"
    pkg="path_replay" type="path_replay" name="path_replay">
    <param name="csv_path" type="string"
      value="$(arg bagfile_home)/$(arg bagfile)_poses_out.csv"/>
    <remap from="~odometry_in" to="/sam_estimator/odometry"/>
  </node>

  <!-- Launch tf generator -->
  <include file="$(find iris_tf)/launch/node.launch">
    <arg name="topic" value="/path_replay/odometry"/>
  </include>

</launch>
